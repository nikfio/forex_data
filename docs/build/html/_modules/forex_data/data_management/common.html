

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>forex_data.data_management.common &mdash; forex_data 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=9edc463e" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=01f34227"></script>
      <script src="../../../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../../../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            forex_data
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#prerequisites">Prerequisites</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../installation.html#installing-poetry">Installing Poetry</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#installation-steps">Installation Steps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../installation.html#clone-the-repository">1. Clone the Repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../installation.html#install-dependencies">2. Install Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../installation.html#verify-installation">3. Verify Installation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#alternative-installation-methods">Alternative Installation Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../installation.html#using-pip-not-recommended">Using pip (Not Recommended)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#installation-options">Installation Options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../installation.html#development-installation">Development Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../installation.html#minimal-installation">Minimal Installation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../quickstart.html#basic-concepts">Basic Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../quickstart.html#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../quickstart.html#working-with-historical-data">Working with Historical Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../quickstart.html#basic-usage">Basic Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../quickstart.html#changing-timeframes">Changing Timeframes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../quickstart.html#adding-custom-timeframes">Adding Custom Timeframes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../quickstart.html#visualizing-data">Visualizing Data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../quickstart.html#working-with-real-time-data">Working with Real-time Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../quickstart.html#id1">Basic Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../quickstart.html#get-latest-close-price">Get Latest Close Price</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../quickstart.html#get-recent-history">Get Recent History</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../quickstart.html#get-intraday-data">Get Intraday Data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../quickstart.html#complete-example">Complete Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../quickstart.html#data-engine-selection">Data Engine Selection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../quickstart.html#polars-recommended">Polars (Recommended)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../quickstart.html#pyarrow">PyArrow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../quickstart.html#pandas">Pandas</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../quickstart.html#next-steps">Next Steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../quickstart.html#need-help">Need Help?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../configuration.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration.html#configuration-file">Configuration File</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration.html#basic-configuration-file">Basic Configuration File</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration.html#configuration-options">Configuration Options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration.html#data-engine">DATA_ENGINE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration.html#data-filetype">DATA_FILETYPE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration.html#data-path">DATA_PATH</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration.html#providers-key">PROVIDERS_KEY</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../configuration.html#getting-api-keys">Getting API Keys</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration.html#using-configuration-in-code">Using Configuration in Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration.html#automatic-loading">Automatic Loading</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration.html#explicit-configuration-file">Explicit Configuration File</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration.html#overriding-configuration">Overriding Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration.html#advanced-configuration">Advanced Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration.html#template-configuration-file">Template Configuration File</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration.html#multiple-configuration-files">Multiple Configuration Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration.html#environment-variables">Environment Variables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration.html#configuration-best-practices">Configuration Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration.html#example-production-configuration">Example: Production Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration.html#configuration-not-found">Configuration Not Found</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration.html#invalid-api-key">Invalid API Key</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration.html#permission-denied">Permission Denied</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../examples.html#historical-data-examples">Historical Data Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples.html#example-1-basic-data-retrieval">Example 1: Basic Data Retrieval</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples.html#example-2-working-with-multiple-timeframes">Example 2: Working with Multiple Timeframes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples.html#example-3-visualizing-historical-data">Example 3: Visualizing Historical Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples.html#example-4-multi-year-analysis">Example 4: Multi-Year Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples.html#real-time-data-examples">Real-time Data Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples.html#example-5-get-latest-market-price">Example 5: Get Latest Market Price</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples.html#example-6-recent-price-history">Example 6: Recent Price History</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples.html#example-7-specific-date-range-real-time">Example 7: Specific Date Range (Real-time)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples.html#example-8-intraday-real-time-data">Example 8: Intraday Real-time Data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples.html#combined-examples">Combined Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples.html#example-9-historical-real-time-combination">Example 9: Historical + Real-time Combination</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples.html#example-10-multi-currency-analysis">Example 10: Multi-Currency Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples.html#advanced-examples">Advanced Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples.html#example-11-custom-data-processing-pipeline">Example 11: Custom Data Processing Pipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples.html#example-12-error-handling-and-validation">Example 12: Error Handling and Validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples.html#example-13-performance-optimization">Example 13: Performance Optimization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples.html#example-14-export-to-different-formats">Example 14: Export to Different Formats</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples.html#testing-examples">Testing Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples.html#example-15-running-the-test-suite">Example 15: Running the Test Suite</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples.html#tips-and-best-practices">Tips and Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples.html#next-steps">Next Steps</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">forex_data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../forex_data.html">forex_data package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../forex_data.html#subpackages">Subpackages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.config.html">forex_data.config package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.data_management.html">forex_data.data_management package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../forex_data.html#module-forex_data">Module contents</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.read_config_file"><code class="docutils literal notranslate"><span class="pre">read_config_file()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.read_config_string"><code class="docutils literal notranslate"><span class="pre">read_config_string()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.read_config_folder"><code class="docutils literal notranslate"><span class="pre">read_config_folder()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.HistoricalManagerDB"><code class="docutils literal notranslate"><span class="pre">HistoricalManagerDB</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.RealtimeManager"><code class="docutils literal notranslate"><span class="pre">RealtimeManager</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.BASE_DATA_COLUMN_NAME"><code class="docutils literal notranslate"><span class="pre">BASE_DATA_COLUMN_NAME</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.DATA_FILE_COLUMN_INDEX"><code class="docutils literal notranslate"><span class="pre">DATA_FILE_COLUMN_INDEX</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.DEFAULT_PATHS"><code class="docutils literal notranslate"><span class="pre">DEFAULT_PATHS</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.empty_dataframe"><code class="docutils literal notranslate"><span class="pre">empty_dataframe()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.is_empty_dataframe"><code class="docutils literal notranslate"><span class="pre">is_empty_dataframe()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.shape_dataframe"><code class="docutils literal notranslate"><span class="pre">shape_dataframe()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.get_dataframe_column"><code class="docutils literal notranslate"><span class="pre">get_dataframe_column()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.get_dataframe_row"><code class="docutils literal notranslate"><span class="pre">get_dataframe_row()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.get_dataframe_element"><code class="docutils literal notranslate"><span class="pre">get_dataframe_element()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.get_attrs_names"><code class="docutils literal notranslate"><span class="pre">get_attrs_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.any_date_to_datetime64"><code class="docutils literal notranslate"><span class="pre">any_date_to_datetime64()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.get_db_key_elements"><code class="docutils literal notranslate"><span class="pre">get_db_key_elements()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.check_timeframe_str"><code class="docutils literal notranslate"><span class="pre">check_timeframe_str()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.DatabaseConnector"><code class="docutils literal notranslate"><span class="pre">DatabaseConnector</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.DuckDBConnector"><code class="docutils literal notranslate"><span class="pre">DuckDBConnector</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.LocalDBConnector"><code class="docutils literal notranslate"><span class="pre">LocalDBConnector</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.validator_list_timeframe"><code class="docutils literal notranslate"><span class="pre">validator_list_timeframe()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.concat_data"><code class="docutils literal notranslate"><span class="pre">concat_data()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.validator_dir_path"><code class="docutils literal notranslate"><span class="pre">validator_dir_path()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.TickerNotFoundError"><code class="docutils literal notranslate"><span class="pre">TickerNotFoundError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.TickerDataNotFoundError"><code class="docutils literal notranslate"><span class="pre">TickerDataNotFoundError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.TickerDataBadTypeException"><code class="docutils literal notranslate"><span class="pre">TickerDataBadTypeException</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.TickerDataInvalidException"><code class="docutils literal notranslate"><span class="pre">TickerDataInvalidException</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.get_histdata_tickers"><code class="docutils literal notranslate"><span class="pre">get_histdata_tickers()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../forex_data.html#forex_data.POLARS_DTYPE_DICT"><code class="docutils literal notranslate"><span class="pre">POLARS_DTYPE_DICT</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#getting-started">Getting Started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#development-setup">Development Setup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#code-standards">Code Standards</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#python-style-guide">Python Style Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#linting-and-formatting">Linting and Formatting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#testing">Testing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#writing-tests">Writing Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#running-tests">Running Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#continuous-integration">Continuous Integration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#documentation">Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#building-documentation">Building Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#docstring-format">Docstring Format</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#adding-documentation-pages">Adding Documentation Pages</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#contribution-workflow">Contribution Workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#making-changes">Making Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#submitting-a-pull-request">Submitting a Pull Request</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#what-to-contribute">What to Contribute</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#features">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#bug-fixes">Bug Fixes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#id1">Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#tests">Tests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#development-priorities">Development Priorities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#current-focus-areas">Current Focus Areas</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#code-review-process">Code Review Process</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#what-reviewers-look-for">What Reviewers Look For</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#getting-help">Getting Help</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#community-guidelines">Community Guidelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#be-respectful">Be Respectful</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#code-of-conduct">Code of Conduct</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#license">License</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#recognition">Recognition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#thank-you">Thank You!</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../changelog.html#version-0-1-0-current">Version 0.1.0 (Current)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../changelog.html#added">Added</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../changelog.html#core-features">Core Features</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../changelog.html#data-management">Data Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../changelog.html#developer-experience">Developer Experience</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../changelog.html#documentation">Documentation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../changelog.html#known-issues">Known Issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../changelog.html#future-releases">Future Releases</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../changelog.html#planned-for-v0-2-0">Planned for v0.2.0</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../changelog.html#database-integration">Database Integration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../changelog.html#enhanced-features">Enhanced Features</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../changelog.html#performance">Performance</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../changelog.html#planned-for-v0-3-0">Planned for v0.3.0</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../changelog.html#how-to-upgrade">How to Upgrade</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../changelog.html#from-development-to-v0-1-0">From Development to v0.1.0</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../changelog.html#migration-notes">Migration Notes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../changelog.html#v0-1-0-breaking-changes">v0.1.0 Breaking Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../changelog.html#deprecation-warnings">Deprecation Warnings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../changelog.html#version-history-details">Version History Details</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../changelog.html#development-pre-release">Development (Pre-release)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../changelog.html#contributing-to-changelog">Contributing to Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../changelog.html#see-also">See Also</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">forex_data</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">forex_data.data_management.common</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for forex_data.data_management.common</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Sat Apr 30 09:23:19 2022</span>

<span class="sd">@author: fiora</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;YEARS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;MONTHS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;DATE_FORMAT_SQL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;DATE_FORMAT_HISTDATA_CSV&#39;</span><span class="p">,</span>
    <span class="s1">&#39;HISTDATA_URL_TICKDATA_TEMPLATE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;HISTDATA_BASE_DOWNLOAD_METHOD&#39;</span><span class="p">,</span>
    <span class="s1">&#39;HISTDATA_BASE_DOWNLOAD_URL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;DEFAULT_PATHS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;DATA_TYPE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;BASE_DATA_COLUMN_NAME&#39;</span><span class="p">,</span>
    <span class="s1">&#39;DATA_FILE_COLUMN_INDEX&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SUPPORTED_DATA_FILES&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SUPPORTED_DATA_ENGINES&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ASSET_TYPE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TEMP_FOLDER&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TEMP_CSV_FILE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;DTYPE_DICT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PYARROW_DTYPE_DICT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;POLARS_DTYPE_DICT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;DATA_COLUMN_NAMES&#39;</span><span class="p">,</span>
    <span class="s1">&#39;FILENAME_TEMPLATE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;DATA_KEY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TICK_TIMEFRAME&#39;</span><span class="p">,</span>
    <span class="s1">&#39;FILENAME_STR&#39;</span><span class="p">,</span>
    <span class="s1">&#39;REALTIME_DATA_PROVIDER&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ALPHA_VANTAGE_API_KEY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CANONICAL_INDEX&#39;</span><span class="p">,</span>
    <span class="s1">&#39;DATE_NO_HOUR_FORMAT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;POLYGON_IO_API_KEY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AV_LIST_URL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PAIR_ALPHAVANTAGE_FORMAT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PAIR_POLYGON_FORMAT&#39;</span><span class="p">,</span>

    <span class="s1">&#39;validator_file_path&#39;</span><span class="p">,</span>
    <span class="s1">&#39;validator_dir_path&#39;</span><span class="p">,</span>
    <span class="s1">&#39;get_attrs_names&#39;</span><span class="p">,</span>
    <span class="s1">&#39;check_time_offset_str&#39;</span><span class="p">,</span>
    <span class="s1">&#39;check_timeframe_str&#39;</span><span class="p">,</span>
    <span class="s1">&#39;any_date_to_datetime64&#39;</span><span class="p">,</span>
    <span class="s1">&#39;empty_dataframe&#39;</span><span class="p">,</span>
    <span class="s1">&#39;is_empty_dataframe&#39;</span><span class="p">,</span>
    <span class="s1">&#39;shape_dataframe&#39;</span><span class="p">,</span>
    <span class="s1">&#39;get_dataframe_column&#39;</span><span class="p">,</span>
    <span class="s1">&#39;get_dataframe_row&#39;</span><span class="p">,</span>
    <span class="s1">&#39;get_dataframe_element&#39;</span><span class="p">,</span>
    <span class="s1">&#39;get_dotty_leafs&#39;</span><span class="p">,</span>
    <span class="s1">&#39;astype&#39;</span><span class="p">,</span>
    <span class="s1">&#39;read_csv&#39;</span><span class="p">,</span>
    <span class="s1">&#39;polars_datetime&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sort_dataframe&#39;</span><span class="p">,</span>
    <span class="s1">&#39;concat_data&#39;</span><span class="p">,</span>
    <span class="s1">&#39;list_remove_duplicates&#39;</span><span class="p">,</span>
    <span class="s1">&#39;get_dotty_key_field&#39;</span><span class="p">,</span>
    <span class="s1">&#39;reframe_data&#39;</span><span class="p">,</span>
    <span class="s1">&#39;write_csv&#39;</span><span class="p">,</span>
    <span class="s1">&#39;write_parquet&#39;</span><span class="p">,</span>
    <span class="s1">&#39;read_parquet&#39;</span><span class="p">,</span>
    <span class="s1">&#39;to_pandas_dataframe&#39;</span><span class="p">,</span>
    <span class="s1">&#39;get_pair_symbols&#39;</span><span class="p">,</span>
    <span class="s1">&#39;to_source_symbol&#39;</span><span class="p">,</span>
    <span class="s1">&#39;get_date_interval&#39;</span><span class="p">,</span>
    <span class="s1">&#39;polygon_agg_to_dict&#39;</span><span class="p">,</span>
    <span class="s1">&#39;validator_list_timeframe&#39;</span><span class="p">,</span>
    <span class="s1">&#39;get_histdata_tickers&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TickerNotFoundError&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TickerDataNotFoundError&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TickerDataBadTypeException&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TickerDataInvalidException&#39;</span>
<span class="p">]</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">loguru</span><span class="w"> </span><span class="kn">import</span> <span class="n">logger</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">re</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">fullmatch</span><span class="p">,</span>
    <span class="n">findall</span><span class="p">,</span>
    <span class="n">search</span>
<span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">cast</span><span class="p">,</span>
    <span class="n">Any</span><span class="p">,</span>
    <span class="n">List</span>
<span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bs4</span><span class="w"> </span><span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">timedelta</span>
<span class="p">)</span>

<span class="c1"># PANDAS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">DataFrame</span> <span class="k">as</span> <span class="n">pandas_dataframe</span><span class="p">,</span>
    <span class="n">concat</span> <span class="k">as</span> <span class="n">pandas_concat</span><span class="p">,</span>
    <span class="n">Timestamp</span><span class="p">,</span>
    <span class="n">isnull</span><span class="p">,</span>
    <span class="n">bdate_range</span><span class="p">,</span>
    <span class="n">to_datetime</span><span class="p">,</span>
    <span class="n">Timedelta</span><span class="p">,</span>
    <span class="n">read_parquet</span> <span class="k">as</span> <span class="n">pandas_read_parquet</span><span class="p">,</span>
    <span class="n">read_csv</span> <span class="k">as</span> <span class="n">pandas_read_csv</span>
<span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pandas.api.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">is_datetime64_any_dtype</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pandas.tseries.frequencies</span><span class="w"> </span><span class="kn">import</span> <span class="n">to_offset</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pandas.tseries.offsets</span><span class="w"> </span><span class="kn">import</span> <span class="n">DateOffset</span>

<span class="c1"># PYARROW</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyarrow</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">float32</span> <span class="k">as</span> <span class="n">pyarrow_float32</span><span class="p">,</span>
    <span class="n">timestamp</span> <span class="k">as</span> <span class="n">pyarrow_timestamp</span><span class="p">,</span>
    <span class="n">schema</span> <span class="k">as</span> <span class="n">pyarrow_schema</span><span class="p">,</span>
    <span class="n">Table</span><span class="p">,</span>
    <span class="n">table</span> <span class="k">as</span> <span class="n">pyarrow_table</span><span class="p">,</span>
    <span class="n">concat_tables</span><span class="p">,</span>
    <span class="n">csv</span> <span class="k">as</span> <span class="n">arrow_csv</span>
<span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pyarrow.parquet</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">write_table</span><span class="p">,</span>
    <span class="n">read_table</span>
<span class="p">)</span>

<span class="c1"># POLARS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">polars</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">Float32</span> <span class="k">as</span> <span class="n">polars_float32</span><span class="p">,</span>
    <span class="n">Datetime</span> <span class="k">as</span> <span class="n">polars_datetime</span><span class="p">,</span>
    <span class="n">read_csv</span> <span class="k">as</span> <span class="n">polars_read_csv</span><span class="p">,</span>
    <span class="n">concat</span> <span class="k">as</span> <span class="n">polars_concat</span><span class="p">,</span>
    <span class="n">col</span><span class="p">,</span>
    <span class="nb">len</span> <span class="k">as</span> <span class="n">polars_len</span><span class="p">,</span>
    <span class="n">read_parquet</span> <span class="k">as</span> <span class="n">polars_read_parquet</span><span class="p">,</span>
    <span class="n">from_arrow</span><span class="p">,</span>
    <span class="n">DataFrame</span> <span class="k">as</span> <span class="n">polars_dataframe</span><span class="p">,</span>
    <span class="n">LazyFrame</span> <span class="k">as</span> <span class="n">polars_lazyframe</span><span class="p">,</span>
    <span class="n">scan_csv</span> <span class="k">as</span> <span class="n">polars_scan_csv</span><span class="p">,</span>
    <span class="n">scan_parquet</span> <span class="k">as</span> <span class="n">polars_scan_parquet</span>
<span class="p">)</span>

<span class="c1"># POLYGON real time provider</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">polygon.rest.models.aggs</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">Agg</span> <span class="k">as</span> <span class="n">polygon_agg</span>
<span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">dateutil.rrule</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">rrule</span><span class="p">,</span>
    <span class="n">DAILY</span><span class="p">,</span>
    <span class="n">MO</span><span class="p">,</span>
    <span class="n">TU</span><span class="p">,</span>
    <span class="n">WE</span><span class="p">,</span>
    <span class="n">TH</span><span class="p">,</span>
    <span class="n">FR</span>
<span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">attrs</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">field</span><span class="p">,</span>
    <span class="n">validators</span>
<span class="p">)</span>


<span class="c1"># =============================================================================</span>
<span class="c1"># CUSTOM EXCEPTIONS</span>
<span class="c1"># =============================================================================</span>

<span class="c1"># TickerNotFoundError:</span>
<span class="c1"># This exception is raised when the ticker requested is misspelled</span>
<span class="c1"># or does not exist in the database.</span>
<div class="viewcode-block" id="TickerNotFoundError">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.TickerNotFoundError">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TickerNotFoundError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>



<span class="c1"># TickerDataNotFoundError:</span>
<span class="c1"># This exception is raised when the ticker is found</span>
<span class="c1"># but data is not available or data retrieval failed.</span>
<div class="viewcode-block" id="TickerDataNotFoundError">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.TickerDataNotFoundError">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TickerDataNotFoundError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>



<span class="c1"># TickerDataBadTypeException:</span>
<span class="c1"># This exception is raised when the ticker data</span>
<span class="c1"># is found but data type is not compliant with the expected type.</span>
<div class="viewcode-block" id="TickerDataBadTypeException">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.TickerDataBadTypeException">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TickerDataBadTypeException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>



<span class="c1"># TickerDataInvalidException:</span>
<span class="c1"># This exception is raised when the ticker data</span>
<span class="c1"># is not found or invalid for generic reasons.</span>
<div class="viewcode-block" id="TickerDataInvalidException">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.TickerDataInvalidException">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TickerDataInvalidException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>



<span class="c1"># common functions, constants and templates</span>
<span class="n">TEMP_FOLDER</span> <span class="o">=</span> <span class="s2">&quot;Temp&quot;</span>
<span class="n">TEMP_CSV_FILE</span> <span class="o">=</span> <span class="s2">&quot;Temp.csv&quot;</span>

<span class="n">HISTDATA_URL_TICKDATA_TEMPLATE</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">&#39;https://www.histdata.com/download-free-forex-historical-data/?/&#39;</span>
    <span class="s1">&#39;ascii/tick-data-quotes/</span><span class="si">{ticker}</span><span class="s1">/</span><span class="si">{year}</span><span class="s1">/</span><span class="si">{month_num}</span><span class="s1">&#39;</span>
<span class="p">)</span>

<span class="n">HISTDATA_URL_ONEMINDATA_TEMPLATE</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">&#39;http://www.histdata.com/download-free-forex-data/?/&#39;</span>
    <span class="s1">&#39;ascii/1-minute-bar-quotes/</span><span class="si">{pair}</span><span class="s1">/</span><span class="si">{year}</span><span class="s1">/</span><span class="si">{month_num}</span><span class="s1">&#39;</span>
<span class="p">)</span>

<span class="n">HISTDATA_BASE_DOWNLOAD_URL</span> <span class="o">=</span> <span class="s2">&quot;http://www.histdata.com/get.php&quot;</span>
<span class="n">HISTDATA_BASE_DOWNLOAD_METHOD</span> <span class="o">=</span> <span class="s1">&#39;POST&#39;</span>

<span class="n">MONTHS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;January&#39;</span><span class="p">,</span> <span class="s1">&#39;February&#39;</span><span class="p">,</span> <span class="s1">&#39;March&#39;</span><span class="p">,</span> <span class="s1">&#39;April&#39;</span><span class="p">,</span> <span class="s1">&#39;May&#39;</span><span class="p">,</span> <span class="s1">&#39;June&#39;</span><span class="p">,</span>
          <span class="s1">&#39;July&#39;</span><span class="p">,</span> <span class="s1">&#39;August&#39;</span><span class="p">,</span> <span class="s1">&#39;September&#39;</span><span class="p">,</span> <span class="s1">&#39;October&#39;</span><span class="p">,</span> <span class="s1">&#39;November&#39;</span><span class="p">,</span> <span class="s1">&#39;December&#39;</span><span class="p">]</span>
<span class="n">YEARS</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2001</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>


<span class="n">DATE_NO_HOUR_FORMAT</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span>
<span class="n">DATE_FORMAT_ISO8601</span> <span class="o">=</span> <span class="s1">&#39;ISO8601&#39;</span>
<span class="n">DATE_FORMAT_SQL</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span>
<span class="n">DATE_FORMAT_HISTDATA_CSV</span> <span class="o">=</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1"> %H%M%S</span><span class="si">%f</span><span class="s1">&#39;</span>

<span class="c1"># DATA_KEY_TEMPLATE_STR           = &#39;{ticker}.Y{year}.{tf}&#39;</span>
<span class="c1"># DATA_KEY_TEMPLATE_PATTERN       =  &#39;^[A-Za-z]+.Y[0-9]+.[A-Za-z0-9]+&#39;</span>
<span class="c1"># FILENAME_STR                    = &#39;{ticker}_Y{year}_{tf}.{file_ext}&#39;</span>
<span class="n">DATA_KEY_TEMPLATE_STR</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{market}</span><span class="s1">.</span><span class="si">{ticker}</span><span class="s1">.</span><span class="si">{tf}</span><span class="s1">&#39;</span>
<span class="n">DATA_KEY_TEMPLATE_PATTERN</span> <span class="o">=</span> <span class="s1">&#39;^[A-Za-z0-9]_[A-Za-z]+.[A-Za-z0-9]+&#39;</span>
<span class="n">FILENAME_STR</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{market}</span><span class="s1">_</span><span class="si">{ticker}</span><span class="s1">_</span><span class="si">{tf}</span><span class="s1">.</span><span class="si">{file_ext}</span><span class="s1">&#39;</span>
<span class="n">DEFAULT_TIMEZONE</span> <span class="o">=</span> <span class="s1">&#39;utc&#39;</span>
<span class="n">TICK_TIMEFRAME</span> <span class="o">=</span> <span class="s1">&#39;tick&#39;</span>

<span class="c1"># ticker PAIR of forex market</span>
<span class="n">SINGLE_CURRENCY_PATTERN_STR</span> <span class="o">=</span> <span class="s1">&#39;[A-Za-z]</span><span class="si">{3}</span><span class="s1">&#39;</span>
<span class="n">TICKER_PATTERN</span> <span class="o">=</span> <span class="s1">&#39;^&#39;</span> <span class="o">+</span> <span class="n">SINGLE_CURRENCY_PATTERN_STR</span>  \
    <span class="o">+</span> <span class="n">SINGLE_CURRENCY_PATTERN_STR</span> <span class="o">+</span> <span class="s1">&#39;$&#39;</span>
<span class="n">PAIR_GENERIC_FORMAT</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{TO}</span><span class="s1">/</span><span class="si">{FROM}</span><span class="s1">&#39;</span>

<span class="c1"># ALPHAVANTAGE</span>
<span class="n">PAIR_ALPHAVANTAGE_FORMAT</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{TO}</span><span class="s1">/</span><span class="si">{FROM}</span><span class="s1">&#39;</span>
<span class="n">PAIR_ALPHAVANTAGE_PATTERN</span> <span class="o">=</span> <span class="s1">&#39;^&#39;</span> <span class="o">+</span> <span class="n">SINGLE_CURRENCY_PATTERN_STR</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> \
    <span class="o">+</span> <span class="n">SINGLE_CURRENCY_PATTERN_STR</span> <span class="o">+</span> <span class="s1">&#39;$&#39;</span>
<span class="n">ALPHA_VANTAGE_API_KEY</span> <span class="o">=</span> <span class="s1">&#39;ALPHA_VANTAGE_API_KEY&#39;</span>
<span class="n">AV_LIST_URL</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">&#39;https://www.alphavantage.co/query?&#39;</span>
    <span class="s1">&#39;function=LISTING_STATUS&amp;apikey=</span><span class="si">{api_key}</span><span class="s1">&#39;</span>
<span class="p">)</span>

<span class="c1"># PAIR POLYGON IO</span>
<span class="n">PAIR_POLYGON_FORMAT</span> <span class="o">=</span> <span class="s1">&#39;C:</span><span class="si">{TO}{FROM}</span><span class="s1">&#39;</span>
<span class="n">PAIR_POLYGON_PATTERN</span> <span class="o">=</span> <span class="s1">&#39;^C:&#39;</span> <span class="o">+</span> <span class="n">SINGLE_CURRENCY_PATTERN_STR</span> <span class="o">+</span> \
    <span class="n">SINGLE_CURRENCY_PATTERN_STR</span> <span class="o">+</span> <span class="s1">&#39;$&#39;</span>
<span class="n">POLYGON_IO_API_KEY</span> <span class="o">=</span> <span class="s1">&#39;POLYGON_IO_API_KEY&#39;</span>

<span class="c1"># TIME PATTERN</span>
<span class="n">TIME_WINDOW_PATTERN_STR</span> <span class="o">=</span> <span class="s1">&#39;^[-+]?[0-9]+[A-Za-z]{1,}$&#39;</span>
<span class="n">TIME_WINDOW_COMPONENTS_PATTERN_STR</span> <span class="o">=</span> <span class="s1">&#39;^[-+]?[0-9]+|[A-Za-z]{1,}$&#39;</span>
<span class="n">TIME_WINDOW_UNIT_PATTERN_STR</span> <span class="o">=</span> <span class="s1">&#39;[A-Za-z]{1,}$&#39;</span>
<span class="n">GET_YEAR_FROM_TICK_KEY_PATTERN_STR</span> <span class="o">=</span> <span class="s1">&#39;^[A-Za-z].Y[0-9].TICK&#39;</span>
<span class="n">YEAR_FIELD_PATTERN_STR</span> <span class="o">=</span> <span class="s1">&#39;^Y([0-9]{4,})$&#39;</span>

<span class="c1"># auxiliary CONSTANT DEFINITIONS</span>

<span class="c1"># dotty key template: &lt;ticker&gt;.Y&lt;year&gt;.&lt;timeframe&gt;.&lt;data-type&gt;</span>


<div class="viewcode-block" id="DATA_KEY">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.DATA_KEY">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DATA_KEY</span><span class="p">:</span>

    <span class="n">MARKET</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">TICKER_INDEX</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">TF_INDEX</span> <span class="o">=</span> <span class="mi">2</span></div>



<span class="c1"># filename template : &lt;ticker&gt;_Y&lt;year&gt;_&lt;timeframe&gt;.&lt;filetype&gt;</span>
<div class="viewcode-block" id="FILENAME_TEMPLATE">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.FILENAME_TEMPLATE">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FILENAME_TEMPLATE</span><span class="p">:</span>

    <span class="n">TICKER_INDEX</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">YEAR_INDEX</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">YEAR_NUMERICAL_CHAR</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">TF_INDEX</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">FILETYPE_INDEX</span> <span class="o">=</span> <span class="mi">3</span></div>



<div class="viewcode-block" id="DEFAULT_PATHS">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.DEFAULT_PATHS">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DEFAULT_PATHS</span><span class="p">:</span>

    <span class="n">BASE_PATH</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s1">&#39;.database&#39;</span><span class="p">)</span>
    <span class="n">HIST_DATA_FOLDER</span> <span class="o">=</span> <span class="s1">&#39;HistoricalData&#39;</span>
    <span class="n">REALTIME_DATA_FOLDER</span> <span class="o">=</span> <span class="s1">&#39;RealtimeData&#39;</span></div>



<div class="viewcode-block" id="DATA_TYPE">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.DATA_TYPE">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DATA_TYPE</span><span class="p">:</span>

    <span class="n">CSV_FILETYPE</span> <span class="o">=</span> <span class="s1">&#39;csv&#39;</span>
    <span class="n">PARQUET_FILETYPE</span> <span class="o">=</span> <span class="s1">&#39;parquet&#39;</span>
    <span class="n">DUCKDB</span> <span class="o">=</span> <span class="s1">&#39;duckdb&#39;</span></div>



<div class="viewcode-block" id="DATA_FILE_COLUMN_INDEX">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.DATA_FILE_COLUMN_INDEX">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DATA_FILE_COLUMN_INDEX</span><span class="p">:</span>

    <span class="n">TIMESTAMP</span> <span class="o">=</span> <span class="mi">0</span></div>



<span class="n">SUPPORTED_DATA_FILES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">DATA_TYPE</span><span class="o">.</span><span class="n">CSV_FILETYPE</span><span class="p">,</span>
    <span class="n">DATA_TYPE</span><span class="o">.</span><span class="n">PARQUET_FILETYPE</span><span class="p">,</span>
    <span class="n">DATA_TYPE</span><span class="o">.</span><span class="n">DUCKDB</span>
<span class="p">]</span>

<span class="c1"># supported dataframe engines</span>
<span class="c1"># pyarrow is inserted but reframe operation all in pyarrow</span>
<span class="c1"># is not yet available, now it is masked</span>
<span class="c1"># to a refame call with polars</span>
<span class="c1"># reframe_data() on pyarrow Table</span>
<span class="n">SUPPORTED_DATA_ENGINES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;pandas&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pyarrow&#39;</span><span class="p">,</span>
    <span class="s1">&#39;polars&#39;</span><span class="p">,</span>
    <span class="s1">&#39;polars_lazy&#39;</span>
<span class="p">]</span>

<span class="c1"># SINGLE BASE DATA COMPOSIION TEMPLATE: [&#39;open&#39;,&#39;close&#39;,&#39;high&#39;,&#39;low&#39;]</span>
<span class="c1"># with datetime/timestamp as index</span>
<span class="c1"># column names for dataframes TICK and timeframe filtered</span>
<span class="c1"># OHLC and related column names</span>


<div class="viewcode-block" id="DATA_COLUMN_NAMES">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.DATA_COLUMN_NAMES">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DATA_COLUMN_NAMES</span><span class="p">:</span>

    <span class="n">TICK_DATA_NO_PVALUE</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;ask&#39;</span><span class="p">,</span> <span class="s1">&#39;bid&#39;</span><span class="p">,</span> <span class="s1">&#39;vol&#39;</span><span class="p">]</span>
    <span class="n">TICK_DATA</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;ask&#39;</span><span class="p">,</span> <span class="s1">&#39;bid&#39;</span><span class="p">,</span> <span class="s1">&#39;vol&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">]</span>
    <span class="n">TF_DATA</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">]</span>
    <span class="n">TICK_DATA_TIME_INDEX</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ask&#39;</span><span class="p">,</span> <span class="s1">&#39;bid&#39;</span><span class="p">,</span> <span class="s1">&#39;vol&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">]</span>
    <span class="n">TF_DATA_TIME_INDEX</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">]</span>
    <span class="n">POLYGON_IO_AGGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">,</span> <span class="s1">&#39;vwap&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;transactions&#39;</span><span class="p">]</span></div>



<span class="c1"># SELECTED AS SINGLE BASE DATA COMPOSION TEMPLATE</span>
<span class="n">BASE_DATA</span> <span class="o">=</span> <span class="n">DATA_COLUMN_NAMES</span><span class="o">.</span><span class="n">TF_DATA_TIME_INDEX</span>
<span class="n">BASE_DATA_WITH_TIME</span> <span class="o">=</span> <span class="n">DATA_COLUMN_NAMES</span><span class="o">.</span><span class="n">TF_DATA</span>


<div class="viewcode-block" id="REALTIME_DATA_PROVIDER">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.REALTIME_DATA_PROVIDER">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">REALTIME_DATA_PROVIDER</span><span class="p">:</span>

    <span class="n">ALPHA_VANTAGE</span> <span class="o">=</span> <span class="s1">&#39;ALPHA_VANTAGE&#39;</span>
    <span class="n">POLYGON_IO</span> <span class="o">=</span> <span class="s1">&#39;POLYGON-IO&#39;</span></div>



<span class="n">REALTIME_DATA_PROVIDER_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="n">REALTIME_DATA_PROVIDER</span><span class="o">.</span><span class="n">ALPHA_VANTAGE</span><span class="p">,</span>
                               <span class="n">REALTIME_DATA_PROVIDER</span><span class="o">.</span><span class="n">POLYGON_IO</span><span class="p">]</span>


<span class="k">class</span><span class="w"> </span><span class="nc">DB_MODE</span><span class="p">:</span>

    <span class="n">FULL_MODE</span> <span class="o">=</span> <span class="s1">&#39;FULL_MODE&#39;</span>
    <span class="n">HISTORICAL_MODE</span> <span class="o">=</span> <span class="s1">&#39;HISTORICAL_MODE&#39;</span>
    <span class="n">REALTIME_MODE</span> <span class="o">=</span> <span class="s1">&#39;REALTIME_MODE&#39;</span>


<div class="viewcode-block" id="ASSET_TYPE">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.ASSET_TYPE">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ASSET_TYPE</span><span class="p">:</span>

    <span class="n">STOCK</span> <span class="o">=</span> <span class="s1">&#39;STOCK&#39;</span>
    <span class="n">ETF</span> <span class="o">=</span> <span class="s1">&#39;ETF&#39;</span>
    <span class="n">FOREX</span> <span class="o">=</span> <span class="s1">&#39;FOREX&#39;</span></div>



<div class="viewcode-block" id="BASE_DATA_COLUMN_NAME">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.BASE_DATA_COLUMN_NAME">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">BASE_DATA_COLUMN_NAME</span><span class="p">:</span>

    <span class="n">TIMESTAMP</span> <span class="o">=</span> <span class="s1">&#39;timestamp&#39;</span>
    <span class="n">OPEN</span> <span class="o">=</span> <span class="s1">&#39;open&#39;</span>
    <span class="n">HIGH</span> <span class="o">=</span> <span class="s1">&#39;high&#39;</span>
    <span class="n">LOW</span> <span class="o">=</span> <span class="s1">&#39;low&#39;</span>
    <span class="n">CLOSE</span> <span class="o">=</span> <span class="s1">&#39;close&#39;</span>
    <span class="n">ASK</span> <span class="o">=</span> <span class="s1">&#39;ask&#39;</span>
    <span class="n">BID</span> <span class="o">=</span> <span class="s1">&#39;bid&#39;</span>
    <span class="n">VOL</span> <span class="o">=</span> <span class="s1">&#39;vol&#39;</span>
    <span class="n">P_VALUE</span> <span class="o">=</span> <span class="s1">&#39;p&#39;</span>
    <span class="n">TRANSACTIONS</span> <span class="o">=</span> <span class="s1">&#39;transactions&#39;</span>
    <span class="n">VWAP</span> <span class="o">=</span> <span class="s1">&#39;vwap&#39;</span>
    <span class="n">OTC</span> <span class="o">=</span> <span class="s1">&#39;otc&#39;</span></div>



<div class="viewcode-block" id="CANONICAL_INDEX">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.CANONICAL_INDEX">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CANONICAL_INDEX</span><span class="p">:</span>

    <span class="n">AV_LATEST_DATA_INDEX</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">AV_DF_DATA_INDEX</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">AV_DICT_INFO_INDEX</span> <span class="o">=</span> <span class="mi">1</span></div>



<span class="c1"># auxiliary functions</span>

<span class="c1"># get elements from db key</span>
<div class="viewcode-block" id="get_db_key_elements">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.get_db_key_elements">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_db_key_elements</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">fullmatch</span><span class="p">(</span><span class="n">DATA_KEY_TEMPLATE_STR</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">res</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;key </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1"> does not respect regex template </span><span class="si">{</span><span class="n">DATA_KEY_TEMPLATE_STR</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span></div>



<span class="c1"># parse argument to get datetime object with date format as input</span>
<span class="k">def</span><span class="w"> </span><span class="nf">infer_date_from_format_dt</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">date_format</span><span class="o">=</span><span class="s1">&#39;ISO8601&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">unit</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">to_datetime</span><span class="p">(</span><span class="n">s</span><span class="p">,</span>
                           <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">,</span>
                           <span class="n">utc</span><span class="o">=</span><span class="n">utc</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">to_datetime</span><span class="p">(</span><span class="n">s</span><span class="p">,</span>
                           <span class="nb">format</span><span class="o">=</span><span class="n">date_format</span><span class="p">,</span>
                           <span class="n">utc</span><span class="o">=</span><span class="n">utc</span><span class="p">)</span>


<span class="c1"># parse timeframe as string and validate if it is valid</span>
<span class="c1"># following pandas DateOffset freqstr rules and &#39;TICK&#39; (=lowest timeframe available)</span>
<span class="c1"># link to official pandas doc</span>
<span class="c1"># https://pandas.pydata.org/docs/user_guide/timeseries.html#dateoffset-objects</span>
<span class="c1"># add compatibility to polars frequency string</span>

<div class="viewcode-block" id="check_timeframe_str">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.check_timeframe_str">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">check_timeframe_str</span><span class="p">(</span><span class="n">tf</span><span class="p">):</span>

    <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">tf</span> <span class="o">==</span> <span class="s1">&#39;TICK&#39;</span><span class="p">:</span>

        <span class="n">check</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">check</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_offset</span><span class="p">(</span><span class="n">tf</span><span class="p">),</span> <span class="n">DateOffset</span><span class="p">)</span> <span class="ow">or</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">tf</span><span class="p">)</span><span class="o">.</span><span class="n">to_pytimedelta</span><span class="p">(),</span>
                           <span class="n">timedelta</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Type check: Invalid timeframe: </span><span class="si">{</span><span class="n">tf</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">if</span> <span class="n">check</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">tf</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Type check: Invalid timeframe &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;conversion to timedelta: </span><span class="si">{</span><span class="n">tf</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span></div>



<span class="c1"># PAIR symbol functions</span>
<div class="viewcode-block" id="get_pair_symbols">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.get_pair_symbols">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_pair_symbols</span><span class="p">(</span><span class="n">ticker</span><span class="p">):</span>

    <span class="n">components</span> <span class="o">=</span> <span class="n">findall</span><span class="p">(</span><span class="n">SINGLE_CURRENCY_PATTERN_STR</span><span class="p">,</span> <span class="n">ticker</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">components</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">return</span> <span class="kc">None</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">check_symbol</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="n">REALTIME_DATA_PROVIDER</span><span class="o">.</span><span class="n">ALPHA_VANTAGE</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">fullmatch</span><span class="p">(</span><span class="n">PAIR_ALPHAVANTAGE_PATTERN</span><span class="p">,</span> <span class="n">symbol</span><span class="p">):</span>

            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="n">REALTIME_DATA_PROVIDER</span><span class="o">.</span><span class="n">POLYGON_IO</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">fullmatch</span><span class="p">(</span><span class="n">PAIR_POLYGON_FORMAT</span><span class="p">,</span> <span class="n">symbol</span><span class="p">):</span>

            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">fullmatch</span><span class="p">(</span><span class="n">PAIR_POLYGON_FORMAT</span><span class="p">,</span> <span class="n">symbol</span><span class="p">):</span>

            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">return</span> <span class="kc">False</span>


<div class="viewcode-block" id="to_source_symbol">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.to_source_symbol">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">to_source_symbol</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>

    <span class="n">to_symbol</span><span class="p">,</span> <span class="n">from_symbol</span> <span class="o">=</span> <span class="n">get_pair_symbols</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="n">REALTIME_DATA_PROVIDER</span><span class="o">.</span><span class="n">ALPHA_VANTAGE</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">PAIR_ALPHAVANTAGE_FORMAT</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">TO</span><span class="o">=</span><span class="n">to_symbol</span><span class="p">,</span>
                                               <span class="n">FROM</span><span class="o">=</span><span class="n">from_symbol</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="n">REALTIME_DATA_PROVIDER</span><span class="o">.</span><span class="n">POLYGON_IO</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">PAIR_POLYGON_FORMAT</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">TO</span><span class="o">=</span><span class="n">to_symbol</span><span class="p">,</span>
                                          <span class="n">FROM</span><span class="o">=</span><span class="n">from_symbol</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">PAIR_GENERIC_FORMAT</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">TO</span><span class="o">=</span><span class="n">to_symbol</span><span class="p">,</span>
                                          <span class="n">FROM</span><span class="o">=</span><span class="n">from_symbol</span><span class="p">)</span></div>



<span class="c1"># TIMESTAMP RELATED FUNCTIONS</span>

<div class="viewcode-block" id="check_time_offset_str">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.check_time_offset_str">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">check_time_offset_str</span><span class="p">(</span><span class="n">timeoffset_str</span><span class="p">):</span>

    <span class="c1"># TODO: add support for polars time/date offset</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_offset</span><span class="p">(</span><span class="n">timeoffset_str</span><span class="p">),</span> <span class="n">DateOffset</span><span class="p">)</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">timewindow_str_to_timedelta</span><span class="p">(</span><span class="n">time_window_str</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">fullmatch</span><span class="p">(</span><span class="n">TIME_WINDOW_PATTERN_STR</span><span class="p">,</span> <span class="n">time_window_str</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">Timedelta</span><span class="p">(</span><span class="n">time_window_str</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;time window pattern not match: &#39;</span>
                     <span class="s1">&#39;&quot;&lt;integer_multiplier&gt;&lt;unit&gt;&quot; str&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span>


<div class="viewcode-block" id="any_date_to_datetime64">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.any_date_to_datetime64">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">any_date_to_datetime64</span><span class="p">(</span><span class="n">any_date</span><span class="p">,</span>
                           <span class="n">date_format</span><span class="o">=</span><span class="s1">&#39;ISO8601&#39;</span><span class="p">,</span>
                           <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">to_pydatetime</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="n">any_date</span> <span class="o">=</span> <span class="n">infer_date_from_format_dt</span><span class="p">(</span><span class="n">any_date</span><span class="p">,</span>
                                             <span class="n">date_format</span><span class="p">,</span>
                                             <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">to_pydatetime</span><span class="p">:</span>

            <span class="n">any_date</span> <span class="o">=</span> <span class="n">any_date</span><span class="o">.</span><span class="n">to_pydatetime</span><span class="p">()</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;date </span><span class="si">{</span><span class="n">any_date</span><span class="si">}</span><span class="s1"> conversion failed, &#39;</span>
                     <span class="sa">f</span><span class="s1">&#39;failed conversion to </span><span class="si">{</span><span class="n">date_format</span><span class="si">}</span><span class="s1"> &#39;</span>
                     <span class="s1">&#39;date format&#39;</span><span class="p">)</span>
        <span class="k">raise</span>

<span class="c1"># =============================================================================</span>
<span class="c1">#   TODO: is it necessary utc timezone when source is naive?</span>
<span class="c1">#   if not any_date.tzinfo:</span>
<span class="c1">#</span>
<span class="c1">#         any_date = any_date.tz_localize(&#39;utc&#39;)</span>
<span class="c1"># =============================================================================</span>

    <span class="k">return</span> <span class="n">any_date</span></div>



<div class="viewcode-block" id="get_date_interval">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.get_date_interval">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_date_interval</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">interval_start_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">interval_end_mode</span><span class="o">=</span><span class="s1">&#39;now&#39;</span><span class="p">,</span>
                      <span class="n">interval_timespan</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">bdays</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="c1"># create start and end date as timestamp instances</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">interval_timespan</span><span class="p">:</span>

        <span class="c1"># a variety of interval mode could be implemented</span>

        <span class="c1"># &#39;now&#39; - end of date interval is timestamp now</span>
        <span class="k">if</span> <span class="n">interval_end_mode</span> <span class="o">==</span> <span class="s1">&#39;now&#39;</span><span class="p">:</span>

            <span class="n">end_date</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="n">start_date</span> <span class="o">=</span> <span class="n">end_date</span> <span class="o">-</span> <span class="n">timewindow_str_to_timedelta</span><span class="p">(</span><span class="n">interval_timespan</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bdays</span><span class="p">:</span>

            <span class="n">components</span> <span class="o">=</span> <span class="n">findall</span><span class="p">(</span><span class="n">TIME_WINDOW_COMPONENTS_PATTERN_STR</span><span class="p">,</span>
                                 <span class="n">interval_timespan</span><span class="p">)</span>

            <span class="c1"># fixed days redundancy check available only with &#39;d&#39; type requested</span>
            <span class="c1"># timespan</span>
            <span class="k">if</span> <span class="n">components</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span>

                <span class="n">days_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="n">rrule</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="n">DAILY</span><span class="p">,</span>
                          <span class="n">dtstart</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                          <span class="n">until</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                          <span class="n">byweekday</span><span class="o">=</span><span class="p">(</span><span class="n">MO</span><span class="p">,</span> <span class="n">TU</span><span class="p">,</span> <span class="n">WE</span><span class="p">,</span> <span class="n">TH</span><span class="p">,</span> <span class="n">FR</span><span class="p">))</span>
                <span class="p">)</span>

                <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">days_list</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>

                    <span class="n">start_date</span> <span class="o">=</span> <span class="n">start_date</span> <span class="o">-</span> <span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

                    <span class="n">days_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="n">rrule</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="n">DAILY</span><span class="p">,</span>
                              <span class="n">dtstart</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                              <span class="n">until</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                              <span class="n">byweekday</span><span class="o">=</span><span class="p">(</span><span class="n">MO</span><span class="p">,</span> <span class="n">TU</span><span class="p">,</span> <span class="n">WE</span><span class="p">,</span> <span class="n">TH</span><span class="p">,</span> <span class="n">FR</span><span class="p">))</span>
                    <span class="p">)</span>

    <span class="c1"># Timestamp() constructor ensures these are Timestamp objects</span>
    <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">isnull</span><span class="p">(</span><span class="n">start_date</span><span class="p">):</span>
            <span class="n">start_date</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">start_date</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">isnull</span><span class="p">(</span><span class="n">end_date</span><span class="p">):</span>
            <span class="n">end_date</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">end_date</span><span class="p">)</span>

    <span class="n">start_date</span> <span class="o">=</span> <span class="n">any_date_to_datetime64</span><span class="p">(</span><span class="n">start_date</span><span class="p">)</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="n">any_date_to_datetime64</span><span class="p">(</span><span class="n">end_date</span><span class="p">)</span>

    <span class="c1"># generate DateTimeIndex if freq is set</span>
    <span class="c1"># otherwise return just start and end of interval</span>
    <span class="k">if</span> <span class="n">freq</span><span class="p">:</span>

        <span class="n">bdate_dtindex</span> <span class="o">=</span> <span class="n">bdate_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                                    <span class="n">end</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                                    <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span>
                                    <span class="n">tz</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                    <span class="n">normalize</span><span class="o">=</span><span class="n">normalize</span><span class="p">,</span>
                                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span>
                                    <span class="p">)</span>

        <span class="k">return</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">bdate_dtindex</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span></div>



<span class="c1"># BASE OPERATIONS WITH DATAFRAME</span>
<span class="c1"># depending on dataframe engine support</span>
<span class="c1"># for supported engines see var SUPPORTED_DATA_ENGINES</span>

<span class="c1"># DATA ENGINES TYPES DICTIONARY</span>
<div class="viewcode-block" id="DTYPE_DICT">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.DTYPE_DICT">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DTYPE_DICT</span><span class="p">:</span>

    <span class="n">TICK_DTYPE</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ask&#39;</span><span class="p">:</span> <span class="s1">&#39;float32&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;bid&#39;</span><span class="p">:</span> <span class="s1">&#39;float32&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;vol&#39;</span><span class="p">:</span> <span class="s1">&#39;float32&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="s1">&#39;float32&#39;</span><span class="p">}</span>
    <span class="n">TF_DTYPE</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;open&#39;</span><span class="p">:</span> <span class="s1">&#39;float32&#39;</span><span class="p">,</span>
                <span class="s1">&#39;high&#39;</span><span class="p">:</span> <span class="s1">&#39;float32&#39;</span><span class="p">,</span>
                <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="s1">&#39;float32&#39;</span><span class="p">,</span>
                <span class="s1">&#39;close&#39;</span><span class="p">:</span> <span class="s1">&#39;float32&#39;</span><span class="p">}</span>
    <span class="n">TIME_TICK_DTYPE</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="s1">&#39;datetime64[ms]&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;ask&#39;</span><span class="p">:</span> <span class="s1">&#39;float32&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;bid&#39;</span><span class="p">:</span> <span class="s1">&#39;float32&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;vol&#39;</span><span class="p">:</span> <span class="s1">&#39;float32&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="s1">&#39;float32&#39;</span><span class="p">}</span>
    <span class="n">TIME_TF_DTYPE</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="s1">&#39;datetime64[ms]&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;open&#39;</span><span class="p">:</span> <span class="s1">&#39;float32&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;high&#39;</span><span class="p">:</span> <span class="s1">&#39;float32&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="s1">&#39;float32&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;close&#39;</span><span class="p">:</span> <span class="s1">&#39;float32&#39;</span><span class="p">}</span></div>



<div class="viewcode-block" id="PYARROW_DTYPE_DICT">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.PYARROW_DTYPE_DICT">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PYARROW_DTYPE_DICT</span><span class="p">:</span>

    <span class="n">TICK_DTYPE</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ask&#39;</span><span class="p">:</span> <span class="n">pyarrow_float32</span><span class="p">(),</span>
                  <span class="s1">&#39;bid&#39;</span><span class="p">:</span> <span class="n">pyarrow_float32</span><span class="p">(),</span>
                  <span class="s1">&#39;vol&#39;</span><span class="p">:</span> <span class="n">pyarrow_float32</span><span class="p">(),</span>
                  <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="n">pyarrow_float32</span><span class="p">()}</span>
    <span class="n">TF_DTYPE</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;open&#39;</span><span class="p">:</span> <span class="n">pyarrow_float32</span><span class="p">(),</span>
                <span class="s1">&#39;high&#39;</span><span class="p">:</span> <span class="n">pyarrow_float32</span><span class="p">(),</span>
                <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">pyarrow_float32</span><span class="p">(),</span>
                <span class="s1">&#39;close&#39;</span><span class="p">:</span> <span class="n">pyarrow_float32</span><span class="p">()}</span>
    <span class="n">TIME_TICK_DTYPE</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">pyarrow_timestamp</span><span class="p">(</span><span class="s1">&#39;ms&#39;</span><span class="p">),</span>
                       <span class="s1">&#39;ask&#39;</span><span class="p">:</span> <span class="n">pyarrow_float32</span><span class="p">(),</span>
                       <span class="s1">&#39;bid&#39;</span><span class="p">:</span> <span class="n">pyarrow_float32</span><span class="p">(),</span>
                       <span class="s1">&#39;vol&#39;</span><span class="p">:</span> <span class="n">pyarrow_float32</span><span class="p">(),</span>
                       <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="n">pyarrow_float32</span><span class="p">()}</span>
    <span class="n">TIME_TF_DTYPE</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">pyarrow_timestamp</span><span class="p">(</span><span class="s1">&#39;ms&#39;</span><span class="p">),</span>
                     <span class="s1">&#39;open&#39;</span><span class="p">:</span> <span class="n">pyarrow_float32</span><span class="p">(),</span>
                     <span class="s1">&#39;high&#39;</span><span class="p">:</span> <span class="n">pyarrow_float32</span><span class="p">(),</span>
                     <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">pyarrow_float32</span><span class="p">(),</span>
                     <span class="s1">&#39;close&#39;</span><span class="p">:</span> <span class="n">pyarrow_float32</span><span class="p">()}</span></div>



<div class="viewcode-block" id="POLARS_DTYPE_DICT">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.POLARS_DTYPE_DICT">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">POLARS_DTYPE_DICT</span><span class="p">:</span>

    <span class="n">TICK_DTYPE</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ask&#39;</span><span class="p">:</span> <span class="n">polars_float32</span><span class="p">,</span>
                  <span class="s1">&#39;bid&#39;</span><span class="p">:</span> <span class="n">polars_float32</span><span class="p">,</span>
                  <span class="s1">&#39;vol&#39;</span><span class="p">:</span> <span class="n">polars_float32</span><span class="p">,</span>
                  <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="n">polars_float32</span><span class="p">}</span>
    <span class="n">TF_DTYPE</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;open&#39;</span><span class="p">:</span> <span class="n">polars_float32</span><span class="p">,</span>
                <span class="s1">&#39;high&#39;</span><span class="p">:</span> <span class="n">polars_float32</span><span class="p">,</span>
                <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">polars_float32</span><span class="p">,</span>
                <span class="s1">&#39;close&#39;</span><span class="p">:</span> <span class="n">polars_float32</span><span class="p">}</span>
    <span class="n">TIME_TICK_DTYPE</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">polars_datetime</span><span class="p">(</span><span class="s1">&#39;ms&#39;</span><span class="p">),</span>
                       <span class="s1">&#39;ask&#39;</span><span class="p">:</span> <span class="n">polars_float32</span><span class="p">,</span>
                       <span class="s1">&#39;bid&#39;</span><span class="p">:</span> <span class="n">polars_float32</span><span class="p">,</span>
                       <span class="s1">&#39;vol&#39;</span><span class="p">:</span> <span class="n">polars_float32</span><span class="p">,</span>
                       <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="n">polars_float32</span><span class="p">}</span>
    <span class="n">TIME_TF_DTYPE</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">polars_datetime</span><span class="p">(</span><span class="s1">&#39;ms&#39;</span><span class="p">),</span>
                     <span class="s1">&#39;open&#39;</span><span class="p">:</span> <span class="n">polars_float32</span><span class="p">,</span>
                     <span class="s1">&#39;high&#39;</span><span class="p">:</span> <span class="n">polars_float32</span><span class="p">,</span>
                     <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="n">polars_float32</span><span class="p">,</span>
                     <span class="s1">&#39;close&#39;</span><span class="p">:</span> <span class="n">polars_float32</span><span class="p">}</span></div>


<span class="c1"># DATA ENGINES FUNCTIONS</span>


<div class="viewcode-block" id="empty_dataframe">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.empty_dataframe">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">empty_dataframe</span><span class="p">(</span><span class="n">engine</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">engine</span> <span class="o">==</span> <span class="s1">&#39;pandas&#39;</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">pandas_dataframe</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">engine</span> <span class="o">==</span> <span class="s1">&#39;pyarrow&#39;</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">pyarrow_table</span><span class="p">([])</span>

    <span class="k">elif</span> <span class="n">engine</span> <span class="o">==</span> <span class="s1">&#39;polars&#39;</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">polars_dataframe</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">engine</span> <span class="o">==</span> <span class="s1">&#39;polars_lazy&#39;</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">polars_lazyframe</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;function empty_dataframe not available&#39;</span>
                     <span class="sa">f</span><span class="s1">&#39; for engine </span><span class="si">{</span><span class="n">engine</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span></div>



<div class="viewcode-block" id="is_empty_dataframe">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.is_empty_dataframe">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">is_empty_dataframe</span><span class="p">(</span><span class="n">dataframe</span><span class="p">):</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">pandas_dataframe</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">empty</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>

        <span class="k">return</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">dataframe</span><span class="p">))</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">polars_dataframe</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">is_empty</span><span class="p">()</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">polars_lazyframe</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span><span class="o">.</span><span class="n">is_empty</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;function is_empty_dataframe not available&#39;</span>
                     <span class="s1">&#39; for instance of type&#39;</span>
                     <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span></div>



<div class="viewcode-block" id="shape_dataframe">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.shape_dataframe">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">shape_dataframe</span><span class="p">(</span><span class="n">dataframe</span><span class="p">):</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">pandas_dataframe</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">shape</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">shape</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">polars_dataframe</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">shape</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">polars_lazyframe</span><span class="p">):</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">dataframe</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">polars_len</span><span class="p">())</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">dataframe</span><span class="o">.</span><span class="n">collect_schema</span><span class="p">()</span><span class="o">.</span><span class="n">len</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;function shape_dataframe not available&#39;</span>
                     <span class="s1">&#39; for instance of type&#39;</span>
                     <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span></div>



<div class="viewcode-block" id="sort_dataframe">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.sort_dataframe">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">sort_dataframe</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">pandas_dataframe</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="n">column</span><span class="p">])</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">sort_by</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">polars_dataframe</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">nulls_last</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">polars_lazyframe</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">nulls_last</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;function sort_dataframe not available&#39;</span>
                     <span class="s1">&#39; for instance of type&#39;</span>
                     <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span></div>



<div class="viewcode-block" id="get_dataframe_column">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.get_dataframe_column">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_dataframe_column</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">pandas_dataframe</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">polars_dataframe</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">polars_lazyframe</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;function get_dataframe_column not available&#39;</span>
                     <span class="s1">&#39; for instance of type&#39;</span>
                     <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_dataframe_row">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.get_dataframe_row">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_dataframe_row</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">pandas_dataframe</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">polars_dataframe</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">polars_lazyframe</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;function get_dataframe_row not available&#39;</span>
                     <span class="s1">&#39; for instance of type&#39;</span>
                     <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_dataframe_element">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.get_dataframe_element">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_dataframe_element</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">pandas_dataframe</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">column</span><span class="p">][</span><span class="n">row</span><span class="p">]</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">column</span><span class="p">][</span><span class="n">row</span><span class="p">]</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">polars_dataframe</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">column</span><span class="p">][</span><span class="n">row</span><span class="p">]</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">polars_lazyframe</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;function get_dataframe_element not available&#39;</span>
                     <span class="s1">&#39; for instance of type&#39;</span>
                     <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">dtype_dict_to_pyarrow_schema</span><span class="p">(</span><span class="n">dtype_dict</span><span class="p">):</span>

    <span class="k">return</span> <span class="n">pyarrow_schema</span><span class="p">(</span><span class="n">dtype_dict</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>


<div class="viewcode-block" id="astype">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.astype">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">astype</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">dtype_dict</span><span class="p">):</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">pandas_dataframe</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype_dict</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtype_dict_to_pyarrow_schema</span><span class="p">(</span><span class="n">dtype_dict</span><span class="p">))</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">polars_dataframe</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtype_dict</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">polars_lazyframe</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dtype_dict</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;function astype not available&#39;</span>
                     <span class="s1">&#39; for instance of type&#39;</span>
                     <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span></div>



<div class="viewcode-block" id="read_parquet">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.read_parquet">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">read_parquet</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">engine</span> <span class="o">==</span> <span class="s1">&#39;pandas&#39;</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">pandas_read_parquet</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">engine</span> <span class="o">==</span> <span class="s1">&#39;pyarrow&#39;</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">read_table</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">engine</span> <span class="o">==</span> <span class="s1">&#39;polars&#39;</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">polars_read_parquet</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">engine</span> <span class="o">==</span> <span class="s1">&#39;polars_lazy&#39;</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">polars_scan_parquet</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;function read_parquet not available&#39;</span>
                     <span class="sa">f</span><span class="s1">&#39; for engine </span><span class="si">{</span><span class="n">engine</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span></div>



<div class="viewcode-block" id="write_parquet">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.write_parquet">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">write_parquet</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">pandas_dataframe</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">dataframe</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;pandas write parquet failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">write_table</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;pyarrow write parquet failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">polars_dataframe</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">dataframe</span><span class="o">.</span><span class="n">write_parquet</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;polars write parquet failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">polars_lazyframe</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">dataframe</span><span class="o">.</span><span class="n">sink_parquet</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

            <span class="c1"># alternative to sink_parquet()</span>
            <span class="c1"># dataframe.collect(streaming=False).write_parquet(filepath)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;polars lazyframe sink &#39;</span>
                             <span class="s1">&#39;parquet failed: </span><span class="si">{e}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;function write_parquet not available&#39;</span>
                     <span class="s1">&#39; for instance of type&#39;</span>
                     <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span></div>



<div class="viewcode-block" id="read_csv">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.read_csv">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">read_csv</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">engine</span> <span class="o">==</span> <span class="s1">&#39;pandas&#39;</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">pandas_read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">engine</span> <span class="o">==</span> <span class="s1">&#39;pyarrow&#39;</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">arrow_csv</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">engine</span> <span class="o">==</span> <span class="s1">&#39;polars&#39;</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">polars_read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">engine</span> <span class="o">==</span> <span class="s1">&#39;polars_lazy&#39;</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">polars_scan_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;function read_csv not available&#39;</span>
                     <span class="sa">f</span><span class="s1">&#39; for engine </span><span class="si">{</span><span class="n">engine</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span></div>



<div class="viewcode-block" id="write_csv">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.write_csv">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">write_csv</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">pandas_dataframe</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="c1"># IMPORTANT</span>
            <span class="c1"># pandas dataframe case</span>
            <span class="c1"># avoid date_format parameter since it is reported that</span>
            <span class="c1"># it makes to_csv to be excessively long with column data</span>
            <span class="c1"># being datetime data type</span>
            <span class="c1"># see: https://github.com/pandas-dev/pandas/issues/37484</span>
            <span class="c1">#      https://stackoverflow.com/questions/65903287/pandas-1-2-1-to-csv-performance-with-datetime-as-the-index-and-setting-date-form</span>

            <span class="n">dataframe</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span>
                             <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error writing csv file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1">&#39;</span>
                             <span class="sa">f</span><span class="s1">&#39; with data type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">IOError</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">arrow_csv</span><span class="o">.</span><span class="n">write_csv</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error writing csv file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1">&#39;</span>
                             <span class="sa">f</span><span class="s1">&#39; with data type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">IOError</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">polars_dataframe</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">dataframe</span><span class="o">.</span><span class="n">write_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error writing csv file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1">&#39;</span>
                             <span class="sa">f</span><span class="s1">&#39; with data type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">IOError</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">polars_lazyframe</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">dataframe</span><span class="o">.</span><span class="n">sink_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error writing csv file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1">&#39;</span>
                             <span class="sa">f</span><span class="s1">&#39; with data type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">IOError</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;function write_csv not available&#39;</span>
                     <span class="s1">&#39; for instance of type&#39;</span>
                     <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span></div>



<div class="viewcode-block" id="concat_data">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.concat_data">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">concat_data</span><span class="p">(</span><span class="n">data_list</span><span class="o">=</span><span class="n">field</span><span class="p">(</span><span class="n">validator</span><span class="o">=</span><span class="n">validators</span><span class="o">.</span><span class="n">instance_of</span><span class="p">(</span><span class="nb">list</span><span class="p">))):</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;required input as list&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">TypeError</span>

    <span class="c1"># assume data type is unique by input</span>
    <span class="c1"># get type from first element</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pandas_dataframe</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">pandas_concat</span><span class="p">(</span><span class="n">data_list</span><span class="p">,</span>
                             <span class="n">ignore_index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                             <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Table</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">concat_tables</span><span class="p">(</span><span class="n">data_list</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">polars_dataframe</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">polars_concat</span><span class="p">(</span><span class="n">data_list</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">polars_lazyframe</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">polars_concat</span><span class="p">(</span><span class="n">data_list</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;function concat not available&#39;</span>
                     <span class="s1">&#39; for instance of type&#39;</span>
                     <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span></div>



<div class="viewcode-block" id="to_pandas_dataframe">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.to_pandas_dataframe">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">to_pandas_dataframe</span><span class="p">(</span><span class="n">dataframe</span><span class="p">):</span>

    <span class="c1"># convert to pandas dataframe</span>
    <span class="c1"># useful for those calls</span>
    <span class="c1"># requiring pandas as input</span>
    <span class="c1"># or pandas functions not covered</span>
    <span class="c1"># by other dataframe instance</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">pandas_dataframe</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">polars_dataframe</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">use_pyarrow_extension_array</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">polars_lazyframe</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">use_pyarrow_extension_array</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;function to_pandas() not available&#39;</span>
                     <span class="s1">&#39; for instance of type&#39;</span>
                     <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span></div>



<div class="viewcode-block" id="reframe_data">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.reframe_data">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">reframe_data</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">tf</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : TYPE</span>
<span class="sd">        DESCRIPTION.</span>
<span class="sd">    tf : TYPE</span>
<span class="sd">        DESCRIPTION.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        DESCRIPTION.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Dataframe</span>
<span class="sd">        DESCRIPTION.</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">is_empty_dataframe</span><span class="p">(</span><span class="n">dataframe</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">dataframe</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">pandas_dataframe</span><span class="p">):</span>

        <span class="c1"># assert timeframe input value</span>
        <span class="n">tf</span> <span class="o">=</span> <span class="n">check_timeframe_str</span><span class="p">(</span><span class="n">tf</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tf</span> <span class="o">==</span> <span class="n">TICK_TIMEFRAME</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;reframe not possible wih target </span><span class="si">{</span><span class="n">TICK_TIMEFRAME</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">dataframe</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_datetime64_any_dtype</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">TIMESTAMP</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_datetime64_any_dtype</span><span class="p">(</span>
                        <span class="n">dataframe</span><span class="p">[</span><span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">TIMESTAMP</span><span class="p">]):</span>

                    <span class="k">try</span><span class="p">:</span>

                        <span class="n">dataframe</span><span class="p">[</span><span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">TIMESTAMP</span><span class="p">]</span> <span class="o">=</span> <span class="n">any_date_to_datetime64</span><span class="p">(</span>
                            <span class="n">dataframe</span><span class="p">[</span><span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">TIMESTAMP</span><span class="p">])</span>

                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

                        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s1">&#39;Pandas engine: &#39;</span>
                                         <span class="s1">&#39;Failed conversion of timestamp columns &#39;</span>
                                         <span class="s1">&#39;to DatetimeIndex&#39;</span><span class="p">)</span>
                        <span class="k">raise</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Pandas engine: required column with &#39;</span>
                             <span class="sa">f</span><span class="s1">&#39;name </span><span class="si">{</span><span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">TIMESTAMP</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>

        <span class="c1"># use pandas functions to reframe data on pandas Dataframe</span>

        <span class="n">dataframe</span> <span class="o">=</span> <span class="n">sort_dataframe</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">TIMESTAMP</span><span class="p">)</span>

        <span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">TIMESTAMP</span><span class="p">,</span>
                                        <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                        <span class="n">drop</span><span class="o">=</span><span class="kc">True</span>
                                        <span class="p">)</span>

        <span class="c1"># resample based on p value</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">col</span> <span class="ow">in</span> <span class="n">DATA_COLUMN_NAMES</span><span class="o">.</span><span class="n">TICK_DATA_TIME_INDEX</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">]):</span>

            <span class="c1"># resample along &#39;p&#39; column, data in ask, bid, p format</span>
            <span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">tf</span><span class="p">)</span><span class="o">.</span><span class="n">ohlc</span><span class="p">()</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">all</span><span class="p">([</span><span class="n">col</span> <span class="ow">in</span> <span class="n">DATA_COLUMN_NAMES</span><span class="o">.</span><span class="n">TF_DATA_TIME_INDEX</span>
                  <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">]):</span>

            <span class="c1"># resample along given data already in ohlc format</span>
            <span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">tf</span><span class="p">)</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;data columns </span><span class="si">{</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="si">}</span><span class="s1"> invalid, &#39;</span>
                         <span class="sa">f</span><span class="s1">&#39;required </span><span class="si">{</span><span class="n">DATA_COLUMN_NAMES</span><span class="o">.</span><span class="n">TICK_DATA_TIME_INDEX</span><span class="si">}</span><span class="s1"> &#39;</span>
                         <span class="sa">f</span><span class="s1">&#39;or </span><span class="si">{</span><span class="n">DATA_COLUMN_NAMES</span><span class="o">.</span><span class="n">TF_DATA_TIME_INDEX</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>

        <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>

<span class="sd">            use pyarrow functions to reframe data on pyarrow Table</span>
<span class="sd">            could not find easy way to filter an arrow table</span>
<span class="sd">            based on time interval</span>

<span class="sd">            opened an enhancement issue on github</span>

<span class="sd">            https://github.com/apache/arrow/issues/41049</span>

<span class="sd">            As a temporary alternative, convert arrow Table to polars</span>
<span class="sd">            and perform reframe with polars engine</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">col</span> <span class="ow">in</span> <span class="n">DATA_COLUMN_NAMES</span><span class="o">.</span><span class="n">TICK_DATA</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">column_names</span><span class="p">]):</span>

            <span class="c1"># convert to polars dataframe</span>
            <span class="n">dataframe</span> <span class="o">=</span> <span class="n">from_arrow</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span>
                                   <span class="n">schema</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">Any</span><span class="p">,</span> <span class="n">POLARS_DTYPE_DICT</span><span class="o">.</span><span class="n">TIME_TICK_DTYPE</span><span class="p">))</span>

        <span class="k">elif</span> <span class="nb">all</span><span class="p">([</span><span class="n">col</span> <span class="ow">in</span> <span class="n">DATA_COLUMN_NAMES</span><span class="o">.</span><span class="n">TF_DATA</span>
                  <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">column_names</span><span class="p">]):</span>

            <span class="c1"># convert to polars dataframe</span>
            <span class="n">dataframe</span> <span class="o">=</span> <span class="n">from_arrow</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span>
                                   <span class="n">schema</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">Any</span><span class="p">,</span> <span class="n">POLARS_DTYPE_DICT</span><span class="o">.</span><span class="n">TIME_TF_DTYPE</span><span class="p">))</span>

        <span class="c1"># perform operation</span>
        <span class="c1"># convert to arrow Table and return</span>
        <span class="k">return</span> <span class="n">reframe_data</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">tf</span><span class="p">)</span><span class="o">.</span><span class="n">to_arrow</span><span class="p">()</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">polars_dataframe</span><span class="p">):</span>

        <span class="n">tf</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="n">dataframe</span> <span class="o">=</span> <span class="n">sort_dataframe</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">TIMESTAMP</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">col</span> <span class="ow">in</span> <span class="n">DATA_COLUMN_NAMES</span><span class="o">.</span><span class="n">TICK_DATA</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">]):</span>

            <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">group_by_dynamic</span><span class="p">(</span>
                <span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">TIMESTAMP</span><span class="p">,</span>
                <span class="n">every</span><span class="o">=</span><span class="n">tf</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">OPEN</span><span class="p">),</span>
                              <span class="n">col</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">HIGH</span><span class="p">),</span>
                              <span class="n">col</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">LOW</span><span class="p">),</span>
                              <span class="n">col</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">CLOSE</span><span class="p">)</span>
                              <span class="p">)</span>

        <span class="k">elif</span> <span class="nb">all</span><span class="p">([</span><span class="n">col</span> <span class="ow">in</span> <span class="n">DATA_COLUMN_NAMES</span><span class="o">.</span><span class="n">TF_DATA</span>
                  <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">]):</span>

            <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">group_by_dynamic</span><span class="p">(</span>
                <span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">TIMESTAMP</span><span class="p">,</span>
                <span class="n">every</span><span class="o">=</span><span class="n">tf</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">OPEN</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">(),</span>
                              <span class="n">col</span><span class="p">(</span><span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                              <span class="n">col</span><span class="p">(</span><span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">LOW</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                              <span class="n">col</span><span class="p">(</span><span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">CLOSE</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>
                              <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;data columns </span><span class="si">{</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="si">}</span><span class="s1"> invalid, &#39;</span>
                         <span class="sa">f</span><span class="s1">&#39;required </span><span class="si">{</span><span class="n">DATA_COLUMN_NAMES</span><span class="o">.</span><span class="n">TICK_DATA</span><span class="si">}</span><span class="s1"> &#39;</span>
                         <span class="sa">f</span><span class="s1">&#39;or </span><span class="si">{</span><span class="n">DATA_COLUMN_NAMES</span><span class="o">.</span><span class="n">TF_DATA</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">polars_lazyframe</span><span class="p">):</span>

        <span class="n">tf</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">nulls_last</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">col</span> <span class="ow">in</span> <span class="n">DATA_COLUMN_NAMES</span><span class="o">.</span><span class="n">TICK_DATA</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">collect_schema</span><span class="p">()</span><span class="o">.</span><span class="n">names</span><span class="p">()]):</span>

            <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">group_by_dynamic</span><span class="p">(</span>
                <span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">TIMESTAMP</span><span class="p">,</span>
                <span class="n">every</span><span class="o">=</span><span class="n">tf</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">OPEN</span><span class="p">),</span>
                              <span class="n">col</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">HIGH</span><span class="p">),</span>
                              <span class="n">col</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">LOW</span><span class="p">),</span>
                              <span class="n">col</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">CLOSE</span><span class="p">)</span>
                              <span class="p">)</span>

        <span class="k">elif</span> <span class="nb">all</span><span class="p">([</span><span class="n">col</span> <span class="ow">in</span> <span class="n">DATA_COLUMN_NAMES</span><span class="o">.</span><span class="n">TF_DATA</span>
                  <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">collect_schema</span><span class="p">()</span><span class="o">.</span><span class="n">names</span><span class="p">()]):</span>

            <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">group_by_dynamic</span><span class="p">(</span>
                <span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">TIMESTAMP</span><span class="p">,</span>
                <span class="n">every</span><span class="o">=</span><span class="n">tf</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">OPEN</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">(),</span>
                              <span class="n">col</span><span class="p">(</span><span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                              <span class="n">col</span><span class="p">(</span><span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">LOW</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                              <span class="n">col</span><span class="p">(</span><span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">CLOSE</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>
                              <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;data columns </span><span class="si">{</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="si">}</span><span class="s1"> invalid, &#39;</span>
                         <span class="sa">f</span><span class="s1">&#39;required </span><span class="si">{</span><span class="n">DATA_COLUMN_NAMES</span><span class="o">.</span><span class="n">TICK_DATA</span><span class="si">}</span><span class="s1"> &#39;</span>
                         <span class="sa">f</span><span class="s1">&#39;or </span><span class="si">{</span><span class="n">DATA_COLUMN_NAMES</span><span class="o">.</span><span class="n">TF_DATA</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span></div>


<span class="c1"># TODO: function to return filter data with inputs:</span>
        <span class="c1"># column to filter on</span>
        <span class="c1"># start interval value</span>
        <span class="c1"># end interval value</span>
        <span class="c1"># option to return specific row index</span>


<span class="k">def</span><span class="w"> </span><span class="nf">filter_data</span><span class="p">(</span>
    <span class="n">dataframe</span><span class="p">,</span>
    <span class="n">tf</span><span class="p">,</span>
    <span class="n">filter_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">index</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>

    <span class="k">pass</span>

<span class="c1"># UTILS FOR DOTTY DICTIONARY</span>


<div class="viewcode-block" id="get_dotty_key_field">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.get_dotty_key_field">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_dotty_key_field</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;dotty key </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1"> invalid type, str required&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">TypeError</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="n">field</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;index </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s1"> invalid for key </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">raise</span>

    <span class="k">return</span> <span class="n">field</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">get_dotty_keys</span><span class="p">(</span><span class="n">dotty_dict</span><span class="p">,</span>
                   <span class="n">root</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">parent_key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="n">dotty_copy</span> <span class="o">=</span> <span class="n">dotty_dict</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">root</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">dotty_copy</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">level</span><span class="p">:</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">level</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;level must be zero or positive integer&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>

        <span class="c1"># default start at root key</span>
        <span class="n">level_counter</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">pass</span>

    <span class="k">elif</span> <span class="n">parent_key</span><span class="p">:</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent_key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;parent key must be str&#39;</span><span class="p">)</span>

        <span class="n">parent_dict</span> <span class="o">=</span> <span class="n">dotty_copy</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">parent_key</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">parent_dict</span><span class="p">:</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">keys</span> <span class="o">=</span> <span class="n">parent_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s1"> : keys not found under </span><span class="si">{</span><span class="n">parent_key</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">[]</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="k">return</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{parent_key}</span><span class="s1"> key not exist&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">KeyError</span>


<div class="viewcode-block" id="get_dotty_leafs">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.get_dotty_leafs">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_dotty_leafs</span><span class="p">(</span><span class="n">dotty_dict</span><span class="p">):</span>

    <span class="n">leaf_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_leaf</span><span class="p">(</span><span class="n">dotty_dict</span><span class="p">,</span> <span class="n">parent_key</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">dotty_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dotty_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

                    <span class="n">key_w_parent</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{parent}</span><span class="s1">.</span><span class="si">{key}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">parent_key</span><span class="p">,</span>
                                                           <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>

                    <span class="n">get_leaf</span><span class="p">(</span><span class="n">dotty_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">key_w_parent</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>

            <span class="n">leaf_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent_key</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>

            <span class="n">leaf_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent_key</span><span class="p">)</span>

    <span class="c1"># root field is temporary to have common start in any case in all leafs</span>
    <span class="n">get_leaf</span><span class="p">(</span><span class="n">dotty_dict</span><span class="p">,</span> <span class="s1">&#39;root&#39;</span><span class="p">)</span>

    <span class="c1"># leave out root field from all paths to leafs</span>
    <span class="n">original_leaf_keys</span> <span class="o">=</span> <span class="n">leaf_keys</span>
    <span class="n">leaf_keys</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="n">original_leaf_keys</span><span class="p">:</span>
        <span class="n">match_result</span> <span class="o">=</span> <span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?&lt;=root.)</span><span class="se">\\</span><span class="s1">S+&#39;</span><span class="p">,</span> <span class="n">leaf</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match_result</span><span class="p">:</span>
            <span class="n">leaf_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match_result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">leaf_keys</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">get_dotty_key_parent</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;dotty key must be str type&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">TypeError</span>

    <span class="c1"># prune last field and rejoin with &#39;.&#39; separator</span>
    <span class="c1"># to recreate a dotty key</span>
    <span class="n">parent_key</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">parent_key</span>


<span class="c1"># TODO: function that returns all leafs at a given</span>
<span class="c1">#       given level</span>


<span class="c1"># ATTRS</span>

<span class="c1"># ADDED VALIDATORS</span>

<div class="viewcode-block" id="validator_file_path">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.validator_file_path">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">validator_file_path</span><span class="p">(</span><span class="n">file_ext</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_file_path</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">filepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1"> Path creation error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>

                    <span class="n">filepath</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">or</span>
                <span class="n">filepath</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>
            <span class="p">):</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;file </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1"> not exists&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">FileExistsError</span>

    <span class="k">return</span> <span class="n">validate_file_path</span></div>



<div class="viewcode-block" id="validator_dir_path">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.validator_dir_path">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">validator_dir_path</span><span class="p">(</span><span class="n">create_if_missing</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_or_create_dir</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">create_if_missing</span><span class="p">:</span>

            <span class="n">Path</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
                <span class="n">Path</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">or</span>
                <span class="n">Path</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>
            <span class="p">):</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Directory </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1"> not valid&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">validate_or_create_dir</span></div>



<div class="viewcode-block" id="validator_list_timeframe">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.validator_list_timeframe">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">validator_list_timeframe</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Required type list for argument </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">TypeError</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span>
        <span class="n">check_timeframe_str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span>
    <span class="p">]):</span>

        <span class="n">fails</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">check_timeframe_str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Values are not timeframe compatible: &#39;</span>
                          <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">fails</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">validator_list_ge</span><span class="p">(</span><span class="n">min_value</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validator_list_values</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span>
            <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span><span class="p">])</span>
        <span class="p">):</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Required list of int type for argument &#39;</span>
                         <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span>
            <span class="n">val</span> <span class="o">&lt;</span> <span class="n">min_value</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span>
        <span class="p">]):</span>

            <span class="n">fails</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="n">min_value</span>
            <span class="p">]</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Values in </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">fails</span><span class="si">}</span><span class="s1"> &#39;</span>
                         <span class="sa">f</span><span class="s1">&#39;are not greater than </span><span class="si">{</span><span class="n">min_value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>

<span class="c1"># ATTRIBUTES</span>


<div class="viewcode-block" id="get_attrs_names">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.get_attrs_names">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_attrs_names</span><span class="p">(</span><span class="n">instance_object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">instance_object</span><span class="p">,</span> <span class="s1">&#39;__attrs_attrs__&#39;</span><span class="p">):</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">attr</span><span class="o">.</span><span class="n">name</span>
                <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">instance_object</span><span class="o">.</span><span class="n">__attrs_attrs__</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;attribute &quot;__attrs__attrs__&quot; not found in &#39;</span>
                     <span class="sa">f</span><span class="s1">&#39;object </span><span class="si">{</span><span class="n">instance_object</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">KeyError</span></div>


<span class="c1"># GENERIC UTILITIES</span>


<div class="viewcode-block" id="list_remove_duplicates">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.list_remove_duplicates">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">list_remove_duplicates</span><span class="p">(</span><span class="n">list_in</span><span class="p">):</span>

    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">list_in</span><span class="p">))</span></div>



<span class="c1"># HISTDATA utilities</span>

<span class="c1"># Analyze the Histdata Forex download base page</span>
<span class="c1"># https://www.histdata.com/download-free-forex-data/?/ascii/1-minute-bar-quotes</span>
<span class="c1"># and get a list of all avilable tickers in the form as the example &quot;EURUSD&quot;</span>
<div class="viewcode-block" id="get_histdata_tickers">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.get_histdata_tickers">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_histdata_tickers</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all available tickers from HistData.com.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    List[str]</span>
<span class="sd">        List of all available tickers (e.g., [&#39;EURUSD&#39;, &#39;GBPUSD&#39;, ...]).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://www.histdata.com/download-free-forex-data/?/ascii/1-minute-bar-quotes&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>

        <span class="n">tickers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Tickers are typically in links that lead to the pair&#39;s specific page</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">href</span> <span class="o">=</span> <span class="n">link</span><span class="p">[</span><span class="s1">&#39;href&#39;</span><span class="p">]</span>
            <span class="c1"># Pattern check based on the observed links</span>
            <span class="k">if</span> <span class="s2">&quot;/ascii/1-minute-bar-quotes/&quot;</span> <span class="ow">in</span> <span class="n">href</span><span class="p">:</span>
                <span class="n">parts</span> <span class="o">=</span> <span class="n">href</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
                <span class="n">ticker</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="c1"># Validate it&#39;s a valid ticker (usually 6 chars like EURUSD)</span>
                <span class="k">if</span> <span class="n">ticker</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="n">tickers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">tickers</span><span class="p">)))</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to retrieve tickers from HistData: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span></div>

<span class="c1"># REAL TIME PROVIDERS UTILITIES</span>


<div class="viewcode-block" id="polygon_agg_to_dict">
<a class="viewcode-back" href="../../../forex_data.data_management.html#forex_data.polygon_agg_to_dict">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">polygon_agg_to_dict</span><span class="p">(</span><span class="n">agg</span><span class="p">):</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">agg</span><span class="p">,</span> <span class="n">polygon_agg</span><span class="p">):</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;argument invalid type, required &#39;</span>
                     <span class="s1">&#39;polygon.rest.models.aggs.Agg&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">TIMESTAMP</span><span class="p">:</span> <span class="n">agg</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span>
        <span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">OPEN</span><span class="p">:</span> <span class="n">agg</span><span class="o">.</span><span class="n">open</span><span class="p">,</span>
        <span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">HIGH</span><span class="p">:</span> <span class="n">agg</span><span class="o">.</span><span class="n">high</span><span class="p">,</span>
        <span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">LOW</span><span class="p">:</span> <span class="n">agg</span><span class="o">.</span><span class="n">low</span><span class="p">,</span>
        <span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">CLOSE</span><span class="p">:</span> <span class="n">agg</span><span class="o">.</span><span class="n">close</span><span class="p">,</span>
        <span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">VOL</span><span class="p">:</span> <span class="n">agg</span><span class="o">.</span><span class="n">volume</span><span class="p">,</span>
        <span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">TRANSACTIONS</span><span class="p">:</span> <span class="n">agg</span><span class="o">.</span><span class="n">transactions</span><span class="p">,</span>
        <span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">VWAP</span><span class="p">:</span> <span class="n">agg</span><span class="o">.</span><span class="n">vwap</span><span class="p">,</span>
        <span class="n">BASE_DATA_COLUMN_NAME</span><span class="o">.</span><span class="n">OTC</span><span class="p">:</span> <span class="n">agg</span><span class="o">.</span><span class="n">otc</span>
    <span class="p">}</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Nicola Fiorato.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>